<meta name="keywords" content="*memo:vi*">
<meta name="keywords" content="*memo:vim*">
**Vim**

vim
=======================================================

<meta name="keywords" content="*memo:vim.nmap*">
<meta name="keywords" content="*memo:vim.tmap*">
## normal/terminal mode keymap (C-)

| Key        | Normal Original          |   |   | Normal                             |   |   |   | Terminal              | Terminal Original |
| ---        | ---                      | - | - | ---                                | - | - | - | ---                   | ---               |
| C-A        | add                      | M |   | quickhl                            |   |   |   | readline begin        |                   |
| C-B        | one page scroll up       | M |   |                                    |   |   |   | readline back         |                   |
| C-C        | term interrupt           | M |   |                                    |   |   |   | term interrupt        |                   |
| C-D        | half page scroll down    | M | N | one page scroll up                 |   |   |   | Del/EOF               |                   |
| C-E        | one line scroll down     | M |   | close the current win              |   |   |   | readline end          |                   |
| C-F        | one page scroll down     |   | N | one page scroll down               |   |   |   | readline front        |                   |
| C-G        | display info             | M |   | win redraw                         | = | M |   | win redraw            |                   |
| C-H        | h                        | M | N | win left                           | = | M | N | win left              |                   |
| C-I        | TAB                      |   |   | TAB                                |   |   |   | TAB                   |                   |
| C-J        | j                        | M | N | win next                           | = | M | N | win next              |                   |
| C-K        | not used                 | M | N | win prev                           | = | M | N | win prev              |                   |
| C-L        | redraw screen            | M | N | win right                          | = | M | N | win right             |                   |
| C-M        | CR                       |   |   | CR                                 |   |   |   | CR                    |                   |
| C-N        | j                        | M | N | one line scroll down               |   |   |   | readline history next |                   |
| C-O        | prev in jump list        | M |   | pop wbl                            |   | M |   | Terminal-Normal       |                   |
| C-P        | k                        | M | N | one line scroll up                 |   |   |   | readline history prev |                   |
| C-Q        | term start input         | M | N | exec the command in the register q |   |   |   |                       | term start input  |
| C-R        | redo                     |   |   | redo                               |   |   |   |                       |                   |
| C-S        | term stop input          | M |   |                                    |   |   |   | BS                    | term stop input   |
| C-T        | prev in tag list         |   |   | prev in tag list                   |   |   |   |                       |                   |
| C-U        | half page scroll up      | M |   | open wbl                           |   |   |   | readline remove line  |                   |
| C-V        | block visual mode        |   |   | block visual mode                  |   | M |   | paste                 |                   |
| C-W        | win command              |   |   | win command                        | = |   |   | win command           |                   |
| C-X        | subtract                 | M |   | cut                                |   |   |   |                       |                   |
| C-Y        | one line scroll up       | M |   | yank                               |   |   |   |                       |                   |
| C-Z        | term suspend             | M |   | toggle wrap                        |   |   |   | term suspend          |                   |
| Space      | l                        | M |   | fzf bmk                            |   |   |   |                       |                   |
| C-Left     | edit alt file            | M | N | tab prev                           | = | M | N | tab prev              |                   |
| C-Right    | not used                 | M | N | tab next                           | = | M | N | tab next              |                   |
| C-Up       |                          | M |   | tab new                            | = | M |   | tab new               |                   |
| C-Down     |                          | M |   | tab close                          | = | M |   | tab close             |                   |
| Insert     |                          |   |   |                                    |   |   |   |                       |                   |
| Del        |                          |   |   |                                    |   |   |   |                       |                   |
| Tab        | next in jump list        |   |   | next in jump list                  |   |   |   |                       |                   |
| BS         | h                        | M |   | page up                            |   |   |   |                       |                   |
| NL         | j                        |   |   | j                                  |   |   |   |                       |                   |
| CR         | +                        |   |   | +                                  |   |   |   |                       |                   |
| C-;        |                          | M |   | command mode                       |   |   |   |                       |                   |
| C-.        |                          |   |   |                                    |   |   |   |                       |                   |
| C-[        | ESC                      |   |   | ESC                                |   |   |   |                       |                   |
| C-]        | :ta                      |   |   | :ta                                |   |   |   |                       |                   |
| C-W C-X    | exchange windows         |   |   | exchange windows                   |   |   |   |                       |                   |
| C-W C-Z    | close the preview window |   |   | close the preview window           |   |   |   |                       |                   |
| C-PageUp   |                          |   |   |                                    |   |   |   |                       |                   |
| C-PageDown |                          |   |   |                                    |   |   |   |                       |                   |

## command sequence

|                                   | normal         | terminal |
| ---                               | ---            | ---      |
| macro register & execute          | qq -> q -> C-q |          |
| mark line m, cut & paste          | mm -> C-x -> p |          |
| mark line m, yank & paste         | mm -> C-y -> p |          |
| mark line m, cut & paste in term  | mm -> C-x      | C-v      |
| mark line m, yank & paste in term | mm -> C-y      | C-v      |

## normal mode keymap

|   | Key | Original                                       | Map | New            |
| - | --- | ---                                            | --- | ---            |
|   | a   | add                                            |     |                |
| * | b   | backward                                       |     |                |
|   | c   | change                                         |     |                |
|   | d   | delete                                         |     |                |
| * | e   | end                                            |     |                |
|   | f   | find                                           |     |                |
|   | g   | g commands                                     |     |                |
|   | h   | move left                                      |     |                |
|   | i   | insert                                         |     |                |
|   | j   | move down                                      |     |                |
|   | k   | move up                                        |     |                |
|   | l   | move right                                     |     |                |
|   | m   | mark                                           |     |                |
|   | n   | serch next                                     |     |                |
|   | o   | insert                                         |     |                |
|   | p   | put                                            |     |                |
|   | q   | record                                         |     |                |
|   | r   | replace                                        |     |                |
|   | s   | substitute                                     |     |                |
|   | t   | find till                                      |     |                |
|   | u   | undo                                           |     |                |
|   | v   | visual mode                                    |     |                |
|   | w   | word                                           |     |                |
|   | x   | remove                                         |     |                |
|   | y   | yank                                           |     |                |
|   | z   | z commands                                     |     |                |
|   | A   | add                                            |     |                |
| * | B   | backward                                       |     |                |
|   | C   | change                                         |     |                |
|   | D   | delete                                         |     |                |
| * | E   | end                                            |     |                |
|   | F   | find                                           |     |                |
|   | G   | goto                                           |     |                |
|   | H   | home                                           |     |                |
|   | I   | insert                                         |     |                |
|   | J   | join                                           |     |                |
|   | K   | keyword                                        |     |                |
|   | L   | last                                           |     |                |
|   | M   | middle                                         |     |                |
|   | N   | search previous                                |     |                |
|   | O   | insert                                         |     |                |
|   | P   | put                                            |     |                |
|   | Q   | ex mode                                        |     | quit           |
|   | R   | replace                                        |     |                |
| * | S   | substitute                                     |     |                |
|   | T   | find till                                      |     |                |
|   | U   | undo                                           |     |                |
|   | V   | visual mode                                    |     |                |
| * | W   | word                                           |     |                |
| * | X   | remove                                         |     |                |
| * | Y   | yanc                                           |     |                |
| * | Z   |                                                |     |                |
| * | -   | move previous line                             |     |                |
| * | +   | move next line                                 |     |                |
| * | _   | move next line                                 |     |                |
| * | =   | format text                                    |     |                |
| * | [   |                                                |     |                |
| * | ]   |                                                |     |                |
| * | {   |                                                |     |                |
| * | }   |                                                |     |                |
|   | "   | register                                       |     |                |
|   | '   | jump to the first CHAR on the line with a mark | ``` | jump to a mark |
|   | ``` | jump to a mark                                 |     |                |
|   | ~   | switch case                                    |     |                |
| * | Bar |                                                |     |                |
|   | \   |                                                |     |                |
|   | /   | search forward                                 |     |                |
|   | ?   | search backward                                |     |                |
|   | :   | ex mode                                        |     |                |
|   | ;   | repeat find                                    |     |                |
| * | ,   | repeat find                                    |     |                |
|   | .   | repeat                                         |     |                |
|   | <   |                                                |     |                |
|   | >   |                                                |     |                |

- *: not oftenly used commands for me (candidates for remapping)

<meta name="keywords" content="*memo:vim.vmap*">
## visual mode keymap

|   | Key | Original | Map | New            |
| - | --- | ---      | --- | ---            |
|   | C   |          |     | nerd commenter |

<meta name="keywords" content="*memo:vim.imap*">
## insert mode keymap

|   | Key     | Original                                                 | Map   | New                      |
| - | ---     | ---                                                      | ---   | ---                      |
|   | C-A     |                                                          | Home  | the begining of the line |
|   | C-E     |                                                          | End   | the end of the line      |
|   | C-B     |                                                          | Left  | move left                |
|   | C-F     |                                                          | Right | move right               |
|   | C-D     |                                                          | Del   | delete                   |
|   | C-P     | prev match                                               |       |                          |
|   | C-N     | next match                                               |       |                          |
|   | C-X C-P | prev completion                                          |       |                          |
|   | C-X C-N | next completion                                          |       |                          |
|   | C-X C-F | file completion                                          |       |                          |
|   | C-X C-I | completion of keywords in the current and included files |       |                          |
|   | C-X C-D | completion of definitions or macros                      |       |                          |
|   | C-X C-] | completion of tags                                       |       |                          |
|   | C-J     |                                                          |       | skk mode                 |

## basic

### スタートアップ時間計測
~~~
$ vim -c "q" --startuptime log.txt
~~~

### vimrcを読み込まずに起動する
~~~
$ vim -u NONE
~~~

### エラーメッセージを再表示
~~~
:messages
~~~

### index of keymap
~~~
:help index
:help CTRL-
:help c_CTRL-
:help v_CTRL-
:help t_CTRL-
~~~

### mappingを確認する
~~~
:map <C-A>
:verbose imap <tab>
~~~

## vnoremap
### 選択された行を標準入力としてcmdに渡す
~~~
vnoremap A y:'<,'>w !cmd<CR>
~~~

### 現在の行をcmdの引数として渡す
~~~
vnoremap A y:!cmd "<C-R>""<CR>
~~~

<meta name="keywords" content="*memo:vim.script*">
<meta name="keywords" content="*memo:vim.script.syntax*">
## syntax

<meta name="keywords" content="*memo:vim.script.syntax.string*">
### string
~~~
:let a = 'hello'
:echo a[1:3]
ell
~~~

<meta name="keywords" content="*memo:vim.script.syntax.expr*">
### expr
expr           | Description
---            | ---
expr `||` expr | logical OR
expr `&&` expr | logical AND
expr == expr   | equal
expr != expr   | not equal
expr >  expr   | greater than
expr >= expr   | greater than or equal
expr <  expr   | smaller than
expr <= expr   | smaller than or equal
expr =~ expr   | regexp matches
expr !~ expr   | regexp doesn't match
! expr         | logical NOT

~~~
:help expression-syntax
~~~

<meta name="keywords" content="*memo:vim.script.syntax.let*">
### let
~~~
let var = val
let var_list = []
let var_dict = {}
~~~

<meta name="keywords" content="*memo:vim.script.syntax.if*">
### if
~~~
if expr
  statements
elseif expr
  statements
else
  statements
endif
~~~

<meta name="keywords" content="*memo:vim.script.syntax.for*">
### for
~~~
for var in list
  statements
endfor
~~~

<meta name="keywords" content="*memo:vim.script.syntax.while*">
### while
~~~
while expr
  statements
endwhile
~~~

<meta name="keywords" content="*memo:vim.script.syntax.func*">
### func
~~~
func name(arg1, arg2)
  let var1 = a:arg1
  let var2 = a:arg2
endfunc
~~~

<meta name="keywords" content="*memo:vim.script.syntax.args*">
### args
Word   | Description
---    | ---
args   | 
f-args | args to a function
q-args | one single value
cward  | word under the cursor
cWARD  | word under the cursor
cfile  | file under the cursor

<meta name="keywords" content="*memo:vim.script.syntax.autocmd*">
### autocmd
- VimEnter
  - FileType
  - WinEnter             :sp
    - BufRead            :e
    - BufEnter
      - proc modelines
      - FileType
        - BufWinEnter
        - BufWinLeave
    - BufLeave
  - WinLeave
- VimLeave

<meta name="keywords" content="*memo:vim.commands*">
## commands
Command            | Description
-----------------  | ---
:ls                | list all buffers
:[N]b[uffer] [N]   | edit buffer [N] from the buffer list
:[N]bun[load] [N]  | unload buffer [N], remain in the buffer list
:[N]bd[elete] [N]  | unload buffer [N], delete it from the buffer list
:[N]bw[ipeout] [N] | really delete buffer [N]
:%bdelete          | unload all buffers, delete them from the buffer list
:%bwipeout         | really delete all buffers
:sp[lit]           | horizontally split the current window
:vsp[lit]          | vertically split the current window
:noh[lsearch]      | stop the highlighting
:enew              | new unnamed buffer
:new               | new window and new unnamed buffer

## window
~~~
:above help
:below help
:top help
:bot help
:help CTRL-W_r
~~~

## move cursor to a window
Command | Description
---     | ---
C-W t   | move cursor to top-left window
C-W p   | move cursor to previous window
C-W h   | move cursor to left window
C-W j   | move cursor to below window
C-W k   | move cursor to above window
C-W l   | move cursor to right window
C-W w   | move cursor to next window
C-W W   | move cursor to prev window

## move window
Command | Description
---     | ---
C-W r   | rotate windows downwards/rightwards
C-W R   | rotate windows upwards/leftwards
C-W x   | exchange window
C-W K   | move window to top
C-W J   | move window to bot
C-W H   | move window to left
C-W L   | move window to right
C-W T   | move window to a new tab

<meta name="keywords" content="*memo:vim.resize*">
## resize window
Command               | Description
----------------------|---
:res[ize] -N          | decrease window height
:res[ize] +N          | increase window height
:res[ize]  N          | set window height
:vertical res[ize] -N | decrease window width
:vertical res[ize] +N | increase window width
:vertical res[ize]  N | set window width

<meta name="keywords" content="*memo:vim.record*">
## macro
Key | Description
----|---
qq  | start recording into register 'q'
q   | end recording
@q  | execute the contents of register 'q'

<meta name="keywords" content="*memo:vim.encryption*">
## encryption
Command           | Description
------------------|---
:set cm=blowfish2 | set an encryption method
:X                | set a new key
:set key=         | unset a key

### write as an encrypted file
~~~
" set an encryption key
:X
:w
~~~

### write as a normal file
~~~
" unset an encryption key
:set key=
:w
~~~

<meta name="keywords" content="*memo:vim.grep*">
<meta name="keywords" content="*memo:vim.vimgrep*">
## vimgrep

### サブディレクトリの検索
~~~
:vimgrep WORD **/*.h **/*.cpp
~~~

<meta name="keywords" content="*memo:vim.diff*">
## diff

Command           | Description
----------------- | ---
[c                | jump to the previous change
]c                | jump to the next change
[count]do         | :diffget
[count]dp         | :diffput
:diffupdate       | update

<meta name="keywords" content="*memo:vim.netrw*">
## netrw

Command           | Description
----------------- | ---
-                 | up dir
CR                | ファイルを開く
o                 | split  ウィンドウを水平に分割してファイルを開く
v                 | vsplit ウィンドウを垂直に分割してファイルを開く
t                 | tab
P                 | previous window 前回のウィンドウでファイルを開く
p                 | preview プレビュー
i                 | 表示形式変更
R                 | rename
D                 | delete
d                 | make dir

<meta name="keywords" content="*memo:vim.term*">
## terminal

Command      | Description
-------------|---
:term [bash] | start terminal
C-D          | end terminal
C-W C-W      | next window
C-W :        | Ex command
C-W N        | terminal-normal mode
i            | terminal mode
C-W "{reg}   | paste register {reg}
C-W ""       | paste the unnamed register

<meta name="keywords" content="*memo:vim.plugin*">
<meta name="keywords" content="*memo:vim.vim-plug*">
## vim-plug
  | Command          | Description
--|------------------|---
  | :PlugUpgrade     | upgrade vim-plug itself
  | :PlugInstall     | install plugins
  | :PlugUpdate      | update plugins

<meta name="keywords" content="*memo:vim.fugitive*">
## fugitive
  | Command          | Description
--|------------------|---
  | -                | toggle stage / unstage
  | X                | discard changes
  | D                | diff
  | R                | reload the status buffer

### git add --patch
- :Gdiff
  - index (left window), working copy (right window)
  - copy lines from the right to the left window (do, dp)
  - save in the left window (staged)
- :Gcommit

<meta name="keywords" content="*memo:vim.gv*">
## gv
  | Command          | Description
--|------------------|---
  | O                | diff in a new tab
* | D                | diff in a new tab
* | C-X              | :tabclose

<meta name="keywords" content="*memo:vim.agit*">
## agit
  | Command          | Description
--|------------------|---
* | D                | diff in a new tab
* | C-X              | :tabclose

<meta name="keywords" content="*memo:vim.nerdtree*">
## nerdtree
  | Command          | Description
--|------------------|---
  | B                | toggle bookmarks
  | CR               | open
  | o                | open
  | go               | view
  | m                | menu
  | I                | toggle dot files
  | u                | tree root up (close)
  | U                | tree root up
  | r                | refresh the current dir
  | R                | refresh the current root
  | C                | change tree root here
* | .                | C
  | cd               | change CWD to here
  | CD               | change the root to CWD

## nerd commenter
  | Command          | Description
--|------------------|---
  | <Leader>c<Space> | toggle comment
* | C                | toggle comment

## surround
  | Command          | Description
--|------------------|---
  | ds"              | delete surrounding ""
  | cs"'             | change surrounding "" to ''
  | ys2w)            | surround two words by ()

<meta name="keywords" content="*memo:vim.ultisnips*">
## UltiSnips
Command          | Description
-----------------|---
:UltiSnipsEdit   | edit snippets

Key  | Description
-----|---
Tab  | expand snippet
C-N  | next item on menu
C-P  | prev item on menu
C-J  | next place
C-K  | prev place

<meta name="keywords" content="*memo:vim.coc*">
## coc

### g:coc_config_home
~~~
~/.vim/coc-settings.json               (local)
$MY_VIM/coc/win/coc-settings.json      (windows)
$MY_VIM/coc/linux/coc-settings.json    (linux)
~~~

### g:coc_data_home
~~~
~/.vim/coc_data        (local)
$MY_VIM/coc_data/win   (windows)
$MY_VIM/coc_data/linux (linux)
~/.config/coc          (linux local)
~~~

### install
~~~
Plug 'neoclide/coc.nvim', {'branch': 'release'}
~~~

### install LSP
~~~
:CocInstall coc-tsserver
:CocInstall coc-json
:CocInstall coc-python
:CocInstall coc-clangd
:CocInstall coc-snippets
:CocInstall coc-lists
:CocInstall coc-explorer
:CocUninstall coc-explorer
:CocUpdate

:CocInfo
:CocOpenLog
:CocDiagnostics

:CocConfig
:CocLocalConfig

:CocCommand python.setInterpreter
:CocCommand python.setLinter
~~~

<meta name="keywords" content="*memo:vim.vim-lsp*">
## vim-lsp

Key       | Description
----------|---
LspStatus | print status

### pyls

### clangd

### ccls
#### install
~~~
$ pacman -S mingw-w64-x86_64-clang
$ pacman -S mingw-w64-x86_64-clang-tools-extra
$ pacman -S mingw-w64-x86_64-cmake
$ pacman -S mingw-w64-x86_64-ninja
$ pacman -S mingw-w64-x86_64-polly
$ pacman -S mingw-w64-x86_64-jq
$ pacman -S mingw-w64-x86_64-ncurses

$ git clone --depth=1 --recursive https://github.com/MaskRay/ccls
$ cd ccls
$ cmake -S. -Bbuild.ninja/Release -GNinja -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=/usr/local -DCMAKE_CXX_FLAGS=-D__STDC_FORMAT_MACROS
$ cmake --build build.ninja/Release
~~~

#### generate compile_commands.json
~~~
$ cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=YES
~~~

<meta name="keywords" content="*memo:vim.gtags*">
## gtags.vim
~~~
:Gtags <func>
:Gtags -r <func>     # go to the referenced point
~~~

<meta name="keywords" content="*memo:vim.eskk*">
## eskk
~~~
Plug 'tyru/eskk.vim'
let g:eskk#directory = "~/.eskk"
let g:eskk#dictionary = { 'path': "~/.eskk/skk-jisyo.user", 'sorted': 0, 'encoding': 'utf-8', }
let g:eskk#large_dictionary = { 'path': "~/.eskk/SKK-JISYO.L.utf-8", 'sorted': 0, 'encoding': 'utf-8', }
~~~

注意

- gzip圧縮した辞書は使用不可
- sortedは0で使用

Termuxで使用するときの注意

- 辞書のエンコーディングをEUC-JPからUTF-8に変換が必要

<meta name="keywords" content="*memo:dev.skk*">
skk
=======================================================

- [SKK Manual](http://skk-dev.github.io/ddskk/skk.html)
- [SKK日本語入力FEP](http://coexe.web.fc2.com/skkfep.html)
- [SKK辞書](http://openlab.jp/skk/wiki/wiki.cgi?page=SKK%BC%AD%BD%F1)

## 基本操作
Mode     | Command              | Description
---------|----------------------|---
i <-> k  | C-j                  | かな入力へ
k <-> K  | q                    | カタカナ入力へ
k  -> a  | l                    | 半角英数入力へ
k  -> A  | L                    | 全角英数入力へ
k  -> R  | アルファベット大文字 | 漢字開始、送りがな開始
R  -> J  | SPACE                | 変換
J        | SPACE                | 次候補
J        | x                    | 前候補
RJ -> k  | C-g                  | 変換キャンセル
   -> n  | ESC                  | vim normalモードへ

![SKK control flow](images/skk.svg)

## 送り仮名なし
~~~
i
C-j
Kanji
SPACE
~~~

## 送り仮名あり
~~~
i
C-j
UgoKu
SPACE
~~~

<meta name="keywords" content="*memo:dev.ctags*">
ctags
=======================================================
~~~
$ ctags -f out_tag_file -R dir
~~~

<meta name="keywords" content="*memo:dev.gtags*">
gtags
=======================================================
~~~
$ gtags -v
~~~

<meta name="keywords" content="*memo:dev.global*">
global
=======================================================
~~~
$ global func      # list files
$ global -x func   # detailed list files
$ global -r func   # list reference files 
$ global -f files  # list functions
~~~

<script src="third_party/memo_js/inc/markdeep.min.js"></script>
<script src="https://casual-effects.com/markdeep/latest/markdeep.min.js"></script>
<link rel="stylesheet" href="third_party/memo_js/inc/default.css">
<style class="fallback">body{visibility:hidden}</style>
<meta charset="utf-8">
<meta vim:set syntax=txt nowrap:>
